<?php
$places = unserialize('a:15:{i:0;O:8:"stdClass":11:{s:2:"id";s:2:"45";s:4:"type";s:1:"1";s:5:"title";s:16:"Jennycliff Beach";s:3:"lat";s:13:"50.3508191247";s:3:"lon";s:13:"-4.1217460810";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4f58f687e4b0b1456a58cb23";s:9:"fetchdate";s:19:"2013-08-06 12:26:01";s:6:"expiry";s:19:"2013-08-06 19:26:01";s:8:"distance";d:2709.48510218505498414742760360240936279296875;s:17:"distance_adjusted";d:0.09031617007283516962434788410973851568996906280517578125;}i:1;O:8:"stdClass":11:{s:2:"id";s:2:"46";s:4:"type";s:1:"1";s:5:"title";s:12:"Whitsand Bay";s:3:"lat";s:13:"50.3538675101";s:3:"lon";s:13:"-4.2395434177";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"5176bb0e498e72d53fa1deb5";s:9:"fetchdate";s:19:"2013-08-06 12:26:01";s:6:"expiry";s:19:"2013-08-06 19:26:01";s:8:"distance";d:7173.0752554193068135646171867847442626953125;s:17:"distance_adjusted";d:0.239102508513976907966736007438157685101032257080078125;}i:2;O:8:"stdClass":11:{s:2:"id";s:2:"47";s:4:"type";s:1:"1";s:5:"title";s:14:"Kingsand Beach";s:3:"lat";s:13:"50.3338572864";s:3:"lon";s:13:"-4.1998082399";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4c88761494f5a093de2cd01e";s:9:"fetchdate";s:19:"2013-08-06 12:26:01";s:6:"expiry";s:19:"2013-08-06 19:26:01";s:8:"distance";d:5840.3445931296982962521724402904510498046875;s:17:"distance_adjusted";d:0.1946781531043232649214047569330432452261447906494140625;}i:3;O:8:"stdClass":11:{s:2:"id";s:2:"48";s:4:"type";s:1:"1";s:5:"title";s:14:"Torpoint beach";s:3:"lat";s:13:"50.3710601017";s:3:"lon";s:13:"-4.1969919205";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4d68f0cb1b63a1cd7cfa382d";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:3884.52790732474886681302450597286224365234375;s:17:"distance_adjusted";d:0.1294842635774916261848233034470467828214168548583984375;}i:4;O:8:"stdClass":11:{s:2:"id";s:2:"49";s:4:"type";s:1:"1";s:5:"title";s:13:"Cawsand Beach";s:3:"lat";s:13:"50.3309569191";s:3:"lon";s:13:"-4.2008918524";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4c31f3113896e21edaafe790";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:6127.0452999218277909676544368267059326171875;s:17:"distance_adjusted";d:0.2042348433307275834547311887945397756993770599365234375;}i:5;O:8:"stdClass":11:{s:2:"id";s:2:"50";s:4:"type";s:1:"1";s:5:"title";s:14:"Bovisand Beach";s:3:"lat";s:13:"50.3354358062";s:3:"lon";s:13:"-4.1212677956";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4bfb987bbbb7c9280a4b0843";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:4265.285245239641881198622286319732666015625;s:17:"distance_adjusted";d:0.14217617484132138994112892760313116014003753662109375;}i:6;O:8:"stdClass":11:{s:2:"id";s:2:"51";s:4:"type";s:1:"1";s:5:"title";s:17:"Mountbatten Beach";s:3:"lat";s:13:"50.3581272972";s:3:"lon";s:13:"-4.1265293718";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"5197b272498e2e74fb125174";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:1847.57230191753342296578921377658843994140625;s:17:"distance_adjusted";d:0.061585743397251112296597597151048830710351467132568359375;}i:7;O:8:"stdClass":11:{s:2:"id";s:2:"52";s:4:"type";s:1:"1";s:5:"title";s:10:"Batten Bay";s:3:"lat";s:13:"50.3575310000";s:3:"lon";s:13:"-4.1265660000";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"51b491c1498e77ba0e4c108a";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:1899.39730350414311033091507852077484130859375;s:17:"distance_adjusted";d:0.06331324345013809862248166382414638064801692962646484375;}i:8;O:8:"stdClass":11:{s:2:"id";s:2:"53";s:4:"type";s:1:"1";s:5:"title";s:13:"Wembury Beach";s:3:"lat";s:13:"50.3176273354";s:3:"lon";s:13:"-4.0845108032";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4c94d4c9f244b1f74282251d";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:7246.2346104693415327346883714199066162109375;s:17:"distance_adjusted";d:0.241541153682311382500103036363725550472736358642578125;}i:9;O:8:"stdClass":11:{s:2:"id";s:2:"54";s:4:"type";s:1:"1";s:5:"title";s:14:"Commando Beach";s:3:"lat";s:13:"50.3675564425";s:3:"lon";s:13:"-4.1695170941";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4fafbdb7e4b0fa27b8d662c6";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:1982.228252103374643411370925605297088623046875;s:17:"distance_adjusted";d:0.066074275070112487018292313223355449736118316650390625;}i:10;O:8:"stdClass":11:{s:2:"id";s:2:"55";s:4:"type";s:1:"1";s:5:"title";s:14:"Tamerton Beach";s:3:"lat";s:13:"50.4285390000";s:3:"lon";s:13:"-4.1897920000";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4d80a92ba4e2370415b1b8cc";s:9:"fetchdate";s:19:"2013-08-06 12:26:02";s:6:"expiry";s:19:"2013-08-06 19:26:02";s:8:"distance";d:7193.85875988690168014727532863616943359375;s:17:"distance_adjusted";d:0.2397952919962300366574226018201443366706371307373046875;}i:11;O:8:"stdClass":11:{s:2:"id";s:2:"78";s:4:"type";s:1:"2";s:5:"title";s:11:"Cinema Room";s:3:"lat";s:13:"50.3797580000";s:3:"lon";s:13:"-4.1260440000";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"51b61549498e7bc659d27946";s:9:"fetchdate";s:19:"2013-08-06 15:27:39";s:6:"expiry";s:19:"2013-08-13 15:27:39";s:8:"distance";d:1477.228579599063550631399266421794891357421875;s:17:"distance_adjusted";d:0.049240952653302118291467337485300959087908267974853515625;}i:12;O:8:"stdClass":11:{s:2:"id";s:2:"79";s:4:"type";s:1:"2";s:5:"title";s:11:"Reel Cinema";s:3:"lat";s:13:"50.3690619059";s:3:"lon";s:13:"-4.1455793381";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4c3f4a0a3735be9a6f2915a4";s:9:"fetchdate";s:19:"2013-08-06 15:27:39";s:6:"expiry";s:19:"2013-08-13 15:27:39";s:8:"distance";d:351.64551345976036600404768250882625579833984375;s:17:"distance_adjusted";d:0.01172151711532534550108675119872714276425540447235107421875;}i:13;O:8:"stdClass":11:{s:2:"id";s:2:"80";s:4:"type";s:1:"2";s:5:"title";s:10:"Vue Cinema";s:3:"lat";s:13:"50.3672004971";s:3:"lon";s:13:"-4.1240787506";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4ba4eb5cf964a5200cc338e3";s:9:"fetchdate";s:19:"2013-08-06 15:27:39";s:6:"expiry";s:19:"2013-08-13 15:27:39";s:8:"distance";d:1368.487262777752448528190143406391143798828125;s:17:"distance_adjusted";d:0.045616242092591748058527656439764541573822498321533203125;}i:14;O:8:"stdClass":11:{s:2:"id";s:2:"81";s:4:"type";s:1:"2";s:5:"title";s:18:"Jill Cragie Cinema";s:3:"lat";s:13:"50.3740982929";s:3:"lon";s:13:"-4.1387987137";s:6:"source";s:10:"foursquare";s:8:"sourceid";s:24:"4c59867904f9be9a1a74ef60";s:9:"fetchdate";s:19:"2013-08-06 15:27:39";s:6:"expiry";s:19:"2013-08-13 15:27:39";s:8:"distance";d:386.907835864648632195894606411457061767578125;s:17:"distance_adjusted";d:0.012896927862154954069762169410751084797084331512451171875;}}');
$weather = (object) array(
	'city' => 'plymouth',
	'condition' => 'rain',
	'temperature' => 49,
	'precipitation' => 3,
	);
$conditions = (object) array(
	'weather'=>$weather
	);

	function calculateScores($activities, $conditions)
	{
		$activitiesLength = sizeOf($activities);
		echo $activitiesLength;
		$weather = $conditions->weather;
		$processed = array();
		foreach($activities as $place):
			// calculate score for distance
			
			$place->distance = $this->calculateDistance($lat,$lon,$place->lat,$place->lon);
			// calculate a score based on how far away it is
			$place->score_factors = array();
			$place->score_factors->distance_score = 1 - (($place->distance/1000) / $this->radius); 
			switch($place->type):
				case 1: // beach
					$place->score_factors->weather_score = getWeatherScore(TRUE,$conditions->weather);
					break;
				case 2: // cinema
					// look up a suitable film to recommend
					$place->score_factors->weather_score = getWeatherScore(FALSE,$conditions->weather);
					break;
				case 3: // cafe/restaurant
					//$place->score_factors->weather_score = $this->getWeatherScore(FALSE);
					//$place->score_factors->time_score = $this->timeScore(6,10);
					$place->score_factors->artificial = 0.2;
					break;
				default:
					$place->score = 0;
				endswitch;
			$place->score = array_sum($place->score_factors) / count($place->score_factors);
			if($place->score > 0) {
				$processed[] = $place;
			}
		endforeach;
		
		return $processed;
	}

	getWeatherScore($isOutside=TRUE,$weather) {
		
		// predefine first part of score based on the condition, where 1 means suitable and 0 means unsuitable
		$outside_condition_lookup = array(
			'sun' => 1,
			'cloud' => 0.5,
			'rain' => 0
			);
		$inside_condition_lookup = array(
			'sun' => 0.5,
			'cloud' => 0.5,
			'rain' => 1
			);

		$condition_score = $precip_score = $temp_score = 0;
		if($isOutside) {
			$condition_score = $outside_condition_lookup[$weather['condition']];
			$precip_score = 1 - ($weather['precipitation'] / 100);
			$temp_score = $weather['temp'] / 30;
		} else {
			$condition_score = $inside_condition_lookup[$weather['condition']];

			$precip_score = $weather['precipitation'] / 100;
			$temp_score = 1 - ($weather['temp'] / 30);
		}
		$weather_score = ($condition_score + $precip_score + $temp_score) / 3;
		return $weather_score;
	}

echo "<h1>Activities:</h1><pre>";
$scores = calculateScores($places,$conditions);
print_r($scores);
echo "</pre>";
?>